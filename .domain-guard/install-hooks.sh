#!/bin/bash
# KGV Domain Guard Installation Script
# Sets up pre-commit hooks and validation

echo "ðŸ›¡ï¸  Installing KGV Domain Guard..."

# Create git hooks directory if it doesn't exist
mkdir -p .git/hooks

# Copy pre-commit hook
cp .domain-guard/pre-commit-hook.sh .git/hooks/pre-commit
chmod +x .git/hooks/pre-commit

echo "âœ… Pre-commit hook installed"

# Create domain guard configuration
if [ ! -f ".domain-guard/config.json" ]; then
    cat > .domain-guard/config.json << EOF
{
  "version": "1.0.0",
  "enabled": true,
  "strictMode": true,
  "checks": {
    "businessRules": true,
    "eventSchemas": true,
    "valueObjectImmutability": true,
    "aggregateBoundaries": true
  },
  "notifications": {
    "slack": false,
    "email": false,
    "console": true
  },
  "exceptions": {
    "files": [],
    "patterns": []
  }
}
EOF
    echo "âœ… Domain guard configuration created"
fi

# Create validation report template
if [ ! -f ".domain-guard/report-template.md" ]; then
    cat > .domain-guard/report-template.md << EOF
# Domain Validation Report

**Date**: {{DATE}}
**Commit**: {{COMMIT_HASH}}
**Files Checked**: {{FILE_COUNT}}

## Summary
- âœ… **Passed**: {{PASSED_COUNT}}
- âŒ **Violations**: {{VIOLATION_COUNT}}
- âš ï¸  **Warnings**: {{WARNING_COUNT}}

## Violations Found
{{VIOLATIONS}}

## Recommendations
{{RECOMMENDATIONS}}

---
*Generated by KGV Domain Guard v{{VERSION}}*
EOF
    echo "âœ… Report template created"
fi

echo ""
echo "ðŸŽ‰ Domain Guard installation complete!"
echo ""
echo "ðŸ“‹ What's been installed:"
echo "   â€¢ Pre-commit hook for domain validation"
echo "   â€¢ Domain model validation rules"
echo "   â€¢ Configuration files"
echo "   â€¢ Report templates"
echo ""
echo "ðŸ› ï¸  Usage:"
echo "   â€¢ Hooks will run automatically on git commit"
echo "   â€¢ Manual check: .domain-guard/pre-commit-hook.sh"
echo "   â€¢ Configuration: .domain-guard/config.json"
echo ""
echo "ðŸ“š Documentation:"
echo "   â€¢ CLAUDE.md - Domain protection guidelines"
echo "   â€¢ docs/domain-model-documentation.md - Complete specifications"
echo ""